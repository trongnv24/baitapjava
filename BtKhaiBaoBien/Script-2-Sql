-->Tìm số hóa đơn đã mua tất cả các sản phẩm do Singapore sản xuất
SELECT COUNT(DISTINCT HOADON.MAHOADON) AS SoHoaDon
FROM HOADON
JOIN CHITIETHOADON ON HOADON.MAHOADON = CHITIETHOADON.MAHOADON
JOIN SANPHAM ON CHITIETHOADON.MASANPHAM = SANPHAM.MASANPHAM
WHERE SANPHAM.TENSANPHAM = 'Singapore';
-->Có bao nhiêu hóa đơn không phải của khách hàng đăng ký thành viên mua
SELECT COUNT(*) AS SoHoaDonKhongThanhVien
FROM HOADON
WHERE MAKHACHHANG IS null
-->Có bao nhiêu sản phẩm khác nhau được bán ra trong năm 2006
SELECT COUNT(DISTINCT MASANPHAM) AS SoSanPham
FROM CHITIETHOADON
WHERE YEAR(NGAYMUA) = 2006;
-->Cho biết trị giá hóa đơn cao nhất, thấp nhất là bao nhiêu
SELECT MAX(TONGTIEN) AS MaxTongTien, MIN(TONGTIEN) AS MinTongTien
FROM (
    SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
    FROM CHITIETHOADON
    GROUP BY MAHOADON
) AS TongTienHoaDon;
-->Trị giá trung bình của tất cả các hóa đơn được bán ra trong năm 2006 là bao nhiêu
SELECT AVG(TONGTIEN) AS TrungBinhTongTien
FROM (
    SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
    FROM CHITIETHOADON
    WHERE YEAR(NGAYMUA) = 2006
    GROUP BY MAHOADON
) AS TongTienHoaDon;
-->Tính doanh thu bán hàng trong năm 2006
SELECT SUM(TONGTIEN) AS DoanhThu
FROM (
    SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
    FROM CHITIETHOADON
    WHERE YEAR(NGAYMUA) = 2006
    GROUP BY MAHOADON
) AS TongTienHoaDon;
-->Tìm số hóa đơn có trị giá cao nhất trong năm 2006
SELECT TOP 1 MAHOADON, TONGTIEN
FROM (
    SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
    FROM CHITIETHOADON
    WHERE YEAR(NGAYMUA) = 2006
    GROUP BY MAHOADON
    ORDER BY TONGTIEN DESC
) AS TongTienHoaDon;
-->Tìm số hóa đơn có trị giá cao nhất trong năm 2006
SELECT TOP 1 MAHOADON, TONGTIEN
FROM (
    SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
    FROM CHITIETHOADON
    WHERE YEAR(NGAYMUA) = 2006
    GROUP BY MAHOADON
    ORDER BY TONGTIEN DESC
) AS TongTienHoaDon;
-->Tìm họ tên khách hàng đã mua hóa đơn có trị giá cao nhất trong năm 2006
SELECT TOP 1 KHACHHANG.MAKHACHHANG, KHACHHANG.TENKHACHHANG
FROM HOADON
JOIN KHACHHANG ON HOADON.MAKHACHHANG = KHACHHANG.MAKHACHHANG
WHERE HOADON.MAHOADON = (
    SELECT TOP 1 MAHOADON
    FROM (
        SELECT MAHOADON, SUM(SOLUONG * DONGIA) AS TONGTIEN
        FROM CHITIETHOADON
        WHERE YEAR(NGAYMUA) = 2006
        GROUP BY MAHOADON
        ORDER BY TONGTIEN DESC
    ) AS TongTienHoaDon
);
